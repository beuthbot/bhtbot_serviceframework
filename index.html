<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@bhtbot/bhtbotservice</title>
	<meta name="description" content="Documentation for @bhtbot/bhtbotservice">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@bhtbot/bhtbotservice</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>@bhtbot/bhtbotservice</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#bht-bot-service-framework" id="bht-bot-service-framework" style="color: inherit; text-decoration: none;">
					<h1>BHT Bot Service Framework</h1>
				</a>
				<a href="#purpose" id="purpose" style="color: inherit; text-decoration: none;">
					<h2>Purpose</h2>
				</a>
				<p>This library is meant to kickstart new BHT-Bot Service Applications and reduce any existing and future redundancies.</p>
				<p>You can setup a new Service in just a few lines of code. All you have to care about is the implementation of your specific Service Implementations, while Service Communication and Types are offered by the framework.</p>
				<p>Service communication is build w</p>
				<p>The framework contains CommonJS and ES-Modules bundles.</p>
				<a href="#get-in-touch" id="get-in-touch" style="color: inherit; text-decoration: none;">
					<h2>Get in touch</h2>
				</a>
				<p>Here are some starting points if you want to get in touch with the code</p>
				<p>Examples:</p>
				<ul>
					<li>Example Service written in Typescript: <a href="https://github.com/beuthbot/beuthbot/tree/master/cat_microservice">https://github.com/beuthbot/beuthbot/tree/master/cat_microservice</a></li>
					<li>Legacy NodeJS Service migrated to this Framework: <a href="https://github.com/beuthbot/weather_microservice">https://github.com/beuthbot/weather_microservice</a></li>
				</ul>
				<p>Tests:</p>
				<ul>
					<li>Most of the features are also represented in extensive Tests, so you might find it helpful to take a look at <a href="src/lib/service.spec.ts">src/lib/service.spec.ts</a></li>
				</ul>
				<p>Specs:</p>
				<ul>
					<li>Generated technical documentation can be found at: <a href="https://beuthbot.github.io/bhtbot_serviceframework/">https://beuthbot.github.io/bhtbot_serviceframework/</a></li>
				</ul>
				<a href="#quick-start-a-service" id="quick-start-a-service" style="color: inherit; text-decoration: none;">
					<h2>Quick start a service</h2>
				</a>
				<a href="#install" id="install" style="color: inherit; text-decoration: none;">
					<h3>Install</h3>
				</a>
				<p>Install Dependency to your (node)app</p>
				<pre><code class="language-shell"><span class="hljs-meta">$</span><span class="bash"> npm i @bhtbot/bhtbotservice</span>
or
<span class="hljs-meta">$</span><span class="bash"> yarn add @bhtbot/bhtbotservice</span></code></pre>
				<a href="#init--config--port--middleware" id="init--config--port--middleware" style="color: inherit; text-decoration: none;">
					<h3>Init | Config | Port | Middleware</h3>
				</a>
				<p>Inititalize the Service on a port, specified by process environment</p>
				<pre><code>import {Service, AppConfig} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@bhtbot/bhtbotservice&#x27;</span>;
const<span class="hljs-built_in"> config </span>= new AppConfig();
config.port = process.env.CATS_PORT ? Number(process.env.CATS_PORT) : 3000;
const<span class="hljs-built_in"> service </span>= new Service(<span class="hljs-string">&#x27;catService&#x27;</span>, config);</code></pre>
				<p>Other Options for config can be found here: <a href="https://beuthbot.github.io/bhtbot_serviceframework/classes/appconfig.html">https://beuthbot.github.io/bhtbot_serviceframework/classes/appconfig.html</a></p>
				<p>For example, if you need to enable another Middleware for your service (like CORS in this example):</p>
				<pre><code><span class="hljs-comment">//...</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cors&#x27;</span>;
<span class="hljs-comment">//...</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> AppConfig();
config.addMiddleWare(cors());
<span class="hljs-keyword">const</span> service = <span class="hljs-keyword">new</span> Service(<span class="hljs-string">&#x27;catService&#x27;</span>, config);</code></pre>
				<a href="#content-serives-basic-endpoint" id="content-serives-basic-endpoint" style="color: inherit; text-decoration: none;">
					<h3>Content Serives (Basic Endpoint)</h3>
				</a>
				<p>This framework is especially meant for building &quot;Content Services&quot;. The syntax of those requests is defined by the Gateway. </p>
				<p>The current structure of such gateway requests is defined in <a href="https://beuthbot.github.io/bhtbot_serviceframework/classes/gatewayrequest.html">https://beuthbot.github.io/bhtbot_serviceframework/classes/gatewayrequest.html</a></p>
				<p>If you want to handle gateway requests, just listen for an endpoint name of your choice like so</p>
				<pre><code><span class="hljs-comment">/* Listen on endpoint /cat */</span>
service.endpoint(&#x27;cat&#x27;, async<span class="hljs-function"> (<span class="hljs-params">req</span>: G<span class="hljs-params">atewayRequest</span>, <span class="hljs-params">answ</span>: G<span class="hljs-params">atewayAnswer</span>)=&gt;</span>{
    return answ.set<span class="hljs-constructor">Content((<span class="hljs-params">await</span> <span class="hljs-params">queryCat</span>()</span>).url).set<span class="hljs-constructor">Cacheable(<span class="hljs-params">false</span>)</span>;
})</code></pre>
				<p>In this simple use case we just return the provided answer with the generated output as content.
				In most use cases, a content service won&#39;t do any more communication-related stuff within the service itself.</p>
				<a href="#utility-services-advanced-endpoints" id="utility-services-advanced-endpoints" style="color: inherit; text-decoration: none;">
					<h3>Utility Services (Advanced Endpoints)</h3>
				</a>
				<p>If you happen to build a custom &quot;Utility Service&quot; you will probably need other Endpoints, because the default endpoint is bound to the gateway request structures, such as having an user, entities and intents</p>
				<a href="#file-upload" id="file-upload" style="color: inherit; text-decoration: none;">
					<h4>File Upload</h4>
				</a>
				<p>Accept files as input for your service</p>
				<pre><code>  service.file<span class="hljs-constructor">UploadEndpoint(&#x27;<span class="hljs-params">upload</span>&#x27;, <span class="hljs-params">async</span> (<span class="hljs-params">request</span>, <span class="hljs-params">answer</span>)</span> =&gt; {
    const fileKeys = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Object</span>.</span></span>keys(request.files);
    const firstFile: UploadedFile = &lt;UploadedFile&gt;request.files<span class="hljs-literal">[<span class="hljs-identifier">fileKeys</span>[<span class="hljs-number">0</span>]</span>];
    return answer.set<span class="hljs-constructor">Content(<span class="hljs-params">firstFile</span>.<span class="hljs-params">name</span>)</span>;
  });</code></pre>
				<a href="#file-answer" id="file-answer" style="color: inherit; text-decoration: none;">
					<h4>File Answer</h4>
				</a>
				<p>For passing Files as response of Gateway-Requests</p>
				<pre><code>service.endpoint(testEndpoint, async<span class="hljs-function"> (<span class="hljs-params">_request</span>, <span class="hljs-params">_answer</span>) =&gt;</span> {
    return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileAnswer</span>.</span></span>from<span class="hljs-constructor">Path(<span class="hljs-params">testFilePathOGG</span>)</span>;
});</code></pre>
				<a href="#arbitrary-endpoints" id="arbitrary-endpoints" style="color: inherit; text-decoration: none;">
					<h4>Arbitrary Endpoints</h4>
				</a>
				<p>If you need any special endpoint that can&#39;t be created with the given tools, feel free to register them like you usually would within an express server</p>
				<pre><code>service.expressApp.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;/custom&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">req</span>, <span class="hljs-title">res</span>) {</span>
    res.<span class="hljs-built_in">send</span>(<span class="hljs-string">&#x27;Hello Custom endpoint&#x27;</span>)
})</code></pre>
				<a href="#contribution" id="contribution" style="color: inherit; text-decoration: none;">
					<h2>Contribution</h2>
				</a>
				<p>Since this is a university project which will be passed to new students every semester with their own philosophies and goals, this framework is subject of heavy (breaking) changes.</p>
				<p>To keep everybody in sync, any rules and changes made to the project must be visible within this repository.</p>
				<p>All rules and pipelines must be implemented as a script withing <a href="./package.json">package.json</a></p>
				<a href="#building" id="building" style="color: inherit; text-decoration: none;">
					<h3>Building</h3>
				</a>
				<p>For development you can use convenient watchers that will rebuild on file change</p>
				<pre><code><span class="hljs-meta">$</span><span class="bash"> npm watch:build</span>
<span class="hljs-meta">$</span><span class="bash"> npm watch:<span class="hljs-built_in">test</span></span></code></pre>
				<p>Release builds are triggered by</p>
				<pre><code>$ npm <span class="hljs-symbol">build:</span>main
$ npm <span class="hljs-symbol">build:</span><span class="hljs-class"><span class="hljs-keyword">module</span></span></code></pre>
				<a href="#lint-amp-beautify" id="lint-amp-beautify" style="color: inherit; text-decoration: none;">
					<h3>Lint &amp; beautify</h3>
				</a>
				<p>Some code cleanup is done by <code>fix</code> scripts and validated by <code>test</code> scripts</p>
				<pre><code><span class="hljs-variable">$npm</span> <span class="hljs-builtin-name">run</span> fix:prettier
<span class="hljs-variable">$npm</span> <span class="hljs-builtin-name">run</span> fix:lint
<span class="hljs-variable">$npm</span> <span class="hljs-builtin-name">run</span> test:prettier
<span class="hljs-variable">$npm</span> <span class="hljs-builtin-name">run</span> test:lint
<span class="hljs-variable">$npm</span> <span class="hljs-builtin-name">run</span> test:spelling</code></pre>
				<a href="#test" id="test" style="color: inherit; text-decoration: none;">
					<h3>Test</h3>
				</a>
				<p>There are unit tests as well as coverage checks</p>
				<pre><code>$ npm <span class="hljs-keyword">run</span><span class="bash"> <span class="hljs-built_in">test</span>: unit</span>
$ npm <span class="hljs-keyword">run</span><span class="bash"> cov</span></code></pre>
				<a href="#releasing" id="releasing" style="color: inherit; text-decoration: none;">
					<h3>Releasing</h3>
				</a>
				<a href="#deployment" id="deployment" style="color: inherit; text-decoration: none;">
					<h4>Deployment</h4>
				</a>
				<p>The final release script combines all the steps into a single pipeline which also heightens the build version in package.json and commits the version as a tag for the repository.</p>
				<p>This will also generate the docs with <code>npm run doc</code> which will be published to <a href="https://beuthbot.github.io/bhtbot_serviceframework">github pages</a></p>
				<pre><code>$ <span class="hljs-comment"># npm run reset-hard # BEWARE: this will clear your working tree. make sure every changes you want to publish are commited</span>
$ npm <span class="hljs-keyword">run</span><span class="bash"> prepare-release</span></code></pre>
				<a href="#publishing" id="publishing" style="color: inherit; text-decoration: none;">
					<h4>Publishing</h4>
				</a>
				<p>After the build pipeline is finished, you will be provided with information about how to publish, which essentially means pushing your code to the git repository and publishing the build to npmjs</p>
				<pre><code><span class="hljs-variable">$ </span>git push --tags
<span class="hljs-variable">$ </span>npm publish</code></pre>
				<a href="#versioning--changelog" id="versioning--changelog" style="color: inherit; text-decoration: none;">
					<h4>Versioning / Changelog</h4>
				</a>
				<p>The Patch-Versioning is done automagically by the prepare-release script.
					Feature and Major releases can be set manually or with help of <code>npm run standard-version</code>
				You should also consider adding notes to the <a href="./CHANGELOG.md">CHANGELOG.md</a></p>
				<a href="#credits" id="credits" style="color: inherit; text-decoration: none;">
					<h3>Credits</h3>
				</a>
				<p>Credits to Bitjson for providing a mature Typescript starter template <a href="https://github.com/bitjson/typescript-starter">https://github.com/bitjson/typescript-starter</a></p>
				<p>Initial Work by Dennis Walz</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/appconfig.html" class="tsd-kind-icon">App<wbr>Config</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/fileanswer.html" class="tsd-kind-icon">File<wbr>Answer</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/gatewayanswer.html" class="tsd-kind-icon">Gateway<wbr>Answer</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/gatewayfilerequest.html" class="tsd-kind-icon">Gateway<wbr>File<wbr>Request</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/gatewayrequest.html" class="tsd-kind-icon">Gateway<wbr>Request</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/gatewayrequestentity.html" class="tsd-kind-icon">Gateway<wbr>Request<wbr>Entity</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/service.html" class="tsd-kind-icon">Service</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="globals.html#cookiemiddleware" class="tsd-kind-icon">cookie<wbr>Middleware</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="globals.html#fileuploadmiddleware" class="tsd-kind-icon">file<wbr>Upload<wbr>Middleware</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="globals.html#jsonmiddleware" class="tsd-kind-icon">json<wbr>Middleware</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="globals.html#urlencodemiddleware" class="tsd-kind-icon">url<wbr>Encode<wbr>Middleware</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#defaulterrorhandler" class="tsd-kind-icon">default<wbr>Error<wbr>Handler</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>